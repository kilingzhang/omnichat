# Omnichat é¡¹ç›®æ·±åº¦ç†è§£åˆ†æ

## ğŸ“‹ ç›®å½•
1. [é¡¹ç›®æ¦‚è§ˆ](#é¡¹ç›®æ¦‚è§ˆ)
2. [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
3. [æŠ€æœ¯æ ˆåˆ†æ](#æŠ€æœ¯æ ˆåˆ†æ)
4. [å…³é”®è®¾è®¡æ¨¡å¼](#å…³é”®è®¾è®¡æ¨¡å¼)
5. [ä»£ç ç»„ç»‡ç»“æ„](#ä»£ç ç»„ç»‡ç»“æ„)
6. [æ ¸å¿ƒåŠŸèƒ½å®ç°](#æ ¸å¿ƒåŠŸèƒ½å®ç°)
7. [å¤šå¹³å°æ”¯æŒç­–ç•¥](#å¤šå¹³å°æ”¯æŒç­–ç•¥)
8. [æ€§èƒ½ä¼˜åŒ–æœºåˆ¶](#æ€§èƒ½ä¼˜åŒ–æœºåˆ¶)
9. [å¼€å‘å·¥ä½œæµ](#å¼€å‘å·¥ä½œæµ)
10. [é¡¹ç›®ä¼˜åŠ¿ä¸æŒ‘æˆ˜](#é¡¹ç›®ä¼˜åŠ¿ä¸æŒ‘æˆ˜)

---

## é¡¹ç›®æ¦‚è§ˆ

### ğŸ¯ é¡¹ç›®å®šä½
**Omnichat** æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„å¤šå¹³å°æ¶ˆæ¯ SDKï¼Œå®ç°äº† "Write once, run everywhere" çš„ç†å¿µã€‚

### æ ¸å¿ƒä»·å€¼
- **ç»Ÿä¸€æ¥å£**: ä¸€å¥— API æ“ä½œæ‰€æœ‰èŠå¤©å¹³å°
- **æ’ä»¶åŒ–æ¶æ„**: é€šè¿‡é€‚é…å™¨æ¨¡å¼æ”¯æŒå¤šå¹³å°æ‰©å±•
- **èƒ½åŠ›é©±åŠ¨**: è‡ªåŠ¨æ£€æµ‹å’Œæš´éœ²å¹³å°ç‰¹å®šåŠŸèƒ½
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript æ”¯æŒ
- **ç”Ÿäº§å°±ç»ª**: åŒ…å«ç¼“å­˜ã€é˜Ÿåˆ—ã€é‡è¯•ã€ç†”æ–­ç­‰ä¼ä¸šçº§ç‰¹æ€§

### æ”¯æŒå¹³å°
| å¹³å° | çŠ¶æ€ | å®Œæˆåº¦ | ç‰¹æ€§æ”¯æŒ |
|------|------|--------|---------|
| Telegram | âœ… ç”Ÿäº§å°±ç»ª | 100% | å®Œæ•´åŠŸèƒ½ + ç®¡ç† + è®ºå›ä¸»é¢˜ |
| Discord | âœ… ç”Ÿäº§å°±ç»ª | 95% | å®Œæ•´åŠŸèƒ½ + é¢‘é“ç®¡ç† |
| Slack | âœ… ç”Ÿäº§å°±ç»ª | 95% | å®Œæ•´åŠŸèƒ½ + å·¥ä½œåŒºç®¡ç† |
| WhatsApp | âš ï¸ éƒ¨åˆ†æ”¯æŒ | 60% | åŸºç¡€åŠŸèƒ½ï¼ˆéœ€å®Œå–„ï¼‰ |
| Signal | ğŸ”´ å­˜æ ¹ | 10% | ä»…åŸºç¡€æ¡†æ¶ |
| iMessage | ğŸ”´ å­˜æ ¹ | 10% | macOS ä¸“ç”¨ï¼Œä»…å‘é€ |

### é¡¹ç›®è§„æ¨¡
```
æ€»ä»£ç è¡Œæ•°: ~8000+ è¡Œ
æ ¸å¿ƒåŒ…: 1500+ è¡Œ
Telegramé€‚é…å™¨: 2000+ è¡Œ
æµ‹è¯•è¦†ç›–: 41+ ä¸ªæµ‹è¯•ï¼ˆTelegram 157ä¸ªï¼‰
åŒ…æ•°é‡: 8 ä¸ªï¼ˆ1 core + 6 adapters + 1 examplesï¼‰
```

---

## æ ¸å¿ƒæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        åº”ç”¨å±‚ (Application)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Unified Bot  â”‚  â”‚  Simple Bot  â”‚  â”‚  Custom App  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SDK å±‚ (Core SDK)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   SDK Class                           â”‚   â”‚
â”‚  â”‚  - Adapter Manager  (é€‚é…å™¨ç®¡ç†)                      â”‚   â”‚
â”‚  â”‚  - Event System     (äº‹ä»¶ç³»ç»Ÿ)                        â”‚   â”‚
â”‚  â”‚  - Middleware       (ä¸­é—´ä»¶ç®¡é“)                      â”‚   â”‚
â”‚  â”‚  - Capability       (èƒ½åŠ›æ£€æµ‹)                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Utils      â”‚  â”‚   Models     â”‚  â”‚   Errors     â”‚      â”‚
â”‚  â”‚ - Cache      â”‚  â”‚ - Message    â”‚  â”‚ - SDKError   â”‚      â”‚
â”‚  â”‚ - Queue      â”‚  â”‚ - Capability â”‚  â”‚ - APIError   â”‚      â”‚
â”‚  â”‚ - RateLimit  â”‚  â”‚ - User       â”‚  â”‚ - ConfigErr  â”‚      â”‚
â”‚  â”‚ - Resilient  â”‚  â”‚ - Chat       â”‚  â”‚              â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é€‚é…å™¨å±‚ (Adapters)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Telegram  â”‚  â”‚ Discord  â”‚  â”‚  Slack   â”‚  â”‚ WhatsApp â”‚  â”‚
â”‚  â”‚ Adapter  â”‚  â”‚ Adapter  â”‚  â”‚ Adapter  â”‚  â”‚ Adapter  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚              â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¹³å° API å±‚ (Platform APIs)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Telegram  â”‚  â”‚ Discord  â”‚  â”‚  Slack   â”‚  â”‚ WhatsApp â”‚  â”‚
â”‚  â”‚   API    â”‚  â”‚   API    â”‚  â”‚   API    â”‚  â”‚   API    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç»„ä»¶å…³ç³»

```typescript
// 1. SDK åˆå§‹åŒ–æµç¨‹
SDK.constructor() 
  â†’ åŠ è½½é…ç½®
  â†’ æ³¨å†Œé€‚é…å™¨
  â†’ åˆå§‹åŒ–ä¸­é—´ä»¶
  â†’ è®¾ç½®äº‹ä»¶ç›‘å¬

// 2. æ¶ˆæ¯å‘é€æµç¨‹
sdk.send()
  â†’ ä¸­é—´ä»¶é¢„å¤„ç†
  â†’ è·å–ç›®æ ‡é€‚é…å™¨
  â†’ èƒ½åŠ›æ£€æŸ¥
  â†’ é€‚é…å™¨å‘é€
  â†’ ä¸­é—´ä»¶åå¤„ç†
  â†’ è¿”å›ç»“æœ

// 3. æ¶ˆæ¯æ¥æ”¶æµç¨‹
Platform API â†’ Adapter.onMessage()
  â†’ æ¶ˆæ¯æ ‡å‡†åŒ–
  â†’ ä¸­é—´ä»¶å¤„ç†
  â†’ SDKäº‹ä»¶è§¦å‘
  â†’ åº”ç”¨å±‚å›è°ƒ
```

---

## æŠ€æœ¯æ ˆåˆ†æ

### æ ¸å¿ƒæŠ€æœ¯

#### 1. TypeScript (v5.3.3)
```typescript
// å¼ºç±»å‹å®šä¹‰
interface SendContent {
  text?: string;
  mediaUrl?: string;
  mediaType?: 'image' | 'video' | 'audio' | 'file';
  stickerId?: string;
}

// æ³›å‹èƒ½åŠ›
class SimpleCache<T> {
  private cache = new Map<string, { value: T; expiry: number }>();
}

// é«˜çº§ç±»å‹æ¨æ–­
type FullAdapter = Adapter &
  Partial<ConversationAdapter> &
  Partial<InteractionAdapter>;
```

**ä¼˜åŠ¿**:
- ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥
- å‡ºè‰²çš„ IDE æ”¯æŒ
- å‡å°‘è¿è¡Œæ—¶é”™è¯¯
- è‡ªæ–‡æ¡£åŒ–ä»£ç 

#### 2. pnpm Workspace
```yaml
# pnpm-workspace.yaml
packages:
  - 'packages/*'
```

**ä¼˜åŠ¿**:
- å¿«é€Ÿçš„ä¾èµ–å®‰è£…
- èŠ‚çœç£ç›˜ç©ºé—´ï¼ˆç¬¦å·é“¾æ¥ï¼‰
- ä¸¥æ ¼çš„ä¾èµ–ç®¡ç†
- æ”¯æŒ monorepo

#### 3. Vitest (æµ‹è¯•æ¡†æ¶)
```typescript
// ç°ä»£åŒ–çš„æµ‹è¯•ä½“éªŒ
describe('SDK', () => {
  it('should send message', async () => {
    const result = await sdk.send('telegram', { text: 'hi' });
    expect(result.messageId).toBeDefined();
  });
});
```

**ä¼˜åŠ¿**:
- ä¸ Vite åŸç”Ÿé›†æˆ
- æå¿«çš„æµ‹è¯•é€Ÿåº¦
- å…¼å®¹ Jest API
- åŸç”Ÿ ESM æ”¯æŒ

### ä¾èµ–åˆ†æ

#### Core åŒ…ä¾èµ–
```json
{
  "dependencies": {
    // æ— å¤–éƒ¨è¿è¡Œæ—¶ä¾èµ– âœ…
  },
  "devDependencies": {
    "typescript": "^5.3.3",
    "vitest": "^1.2.0"
  }
}
```
**è®¾è®¡å“²å­¦**: Core åŒ…é›¶ä¾èµ–ï¼Œç¡®ä¿è½»é‡å’Œå¯ç§»æ¤æ€§

#### Telegram é€‚é…å™¨ä¾èµ–
```json
{
  "dependencies": {
    "@omnichat/core": "workspace:*",
    "node-telegram-bot-api": "^0.66.0"  // å®˜æ–¹ Telegram SDK
  }
}
```

#### Discord é€‚é…å™¨ä¾èµ–
```json
{
  "dependencies": {
    "@omnichat/core": "workspace:*",
    "discord.js": "^14.14.1"  // å®˜æ–¹ Discord.js
  }
}
```

---

## å…³é”®è®¾è®¡æ¨¡å¼

### 1. é€‚é…å™¨æ¨¡å¼ (Adapter Pattern)
**ç›®çš„**: ç»Ÿä¸€ä¸åŒå¹³å°çš„æ¥å£

```typescript
// ç»Ÿä¸€æ¥å£å®šä¹‰
interface Adapter {
  platform: string;
  init(config: any): Promise<void>;
  send(target: string, content: SendContent): Promise<SendResult>;
  onMessage(callback: MessageCallback): void;
  destroy(): Promise<void>;
}

// å„å¹³å°å®ç°
class TelegramAdapter implements FullAdapter {
  async send(target: string, content: SendContent) {
    // Telegram ç‰¹å®šå®ç°
    return this.bot.sendMessage(chatId, text);
  }
}

class DiscordAdapter implements FullAdapter {
  async send(target: string, content: SendContent) {
    // Discord ç‰¹å®šå®ç°
    return channel.send({ content: text });
  }
}
```

**ä¼˜åŠ¿**:
- éš”ç¦»å¹³å°å·®å¼‚
- æ˜“äºæ·»åŠ æ–°å¹³å°
- ä¸å½±å“ç°æœ‰ä»£ç 

### 2. èƒ½åŠ›æ¨¡å¼ (Capability Pattern)
**ç›®çš„**: å£°æ˜å¼çš„åŠŸèƒ½æ£€æµ‹

```typescript
// èƒ½åŠ›å®šä¹‰
interface Capabilities {
  base: {
    sendText: boolean;
    sendMedia: boolean;
    receive: boolean;
  };
  conversation: {
    reply: boolean;
    edit: boolean;
    delete: boolean;
  };
  interaction: {
    buttons: boolean;
    polls: boolean;
    reactions: boolean;
  };
}

// è¿è¡Œæ—¶æ£€æŸ¥
if (sdk.hasCapability('telegram', 'interaction', 'buttons')) {
  await sdk.sendButtons(...);
}

// æŸ¥æ‰¾æ”¯æŒçš„å¹³å°
const platforms = sdk.getAdaptersByCapability('interaction', 'polls');
// ['telegram', 'discord']
```

**ä¼˜åŠ¿**:
- é¿å…è¿è¡Œæ—¶é”™è¯¯
- ä¼˜é›…é™çº§
- è‡ªæ–‡æ¡£åŒ–

### 3. ä¸­é—´ä»¶æ¨¡å¼ (Middleware Pattern)
**ç›®çš„**: å¯æ‰©å±•çš„æ¶ˆæ¯å¤„ç†ç®¡é“

```typescript
type Middleware = (
  message: Message,
  next: () => Promise<void>
) => Promise<void>;

// ç¤ºä¾‹ï¼šæ—¥å¿—ä¸­é—´ä»¶
const loggingMiddleware: Middleware = async (message, next) => {
  console.log('Before:', message);
  await next();
  console.log('After:', message);
};

// ç¤ºä¾‹ï¼šè¿‡æ»¤ä¸­é—´ä»¶
const filterMiddleware: Middleware = async (message, next) => {
  if (message.content.text?.includes('spam')) {
    return; // é˜»æ­¢ä¼ é€’
  }
  await next();
};

sdk.use(loggingMiddleware);
sdk.use(filterMiddleware);
```

**ä¼˜åŠ¿**:
- å…³æ³¨ç‚¹åˆ†ç¦»
- å¯é‡ç”¨é€»è¾‘
- çµæ´»ç»„åˆ

### 4. äº‹ä»¶å‘å°„å™¨æ¨¡å¼ (Event Emitter)
**ç›®çš„**: è§£è€¦æ¶ˆæ¯ç”Ÿäº§å’Œæ¶ˆè´¹

```typescript
// ç›‘å¬æ‰€æœ‰æ¶ˆæ¯
sdk.on(async (message) => {
  console.log('Received:', message.content.text);
});

// ç›‘å¬ç‰¹å®šå¹³å°
sdk.on(async (message) => {
  if (message.platform === 'telegram') {
    // Telegram ç‰¹å®šå¤„ç†
  }
});
```

### 5. å·¥å‚æ¨¡å¼ (Factory Pattern)
**ç›®çš„**: åŠ¨æ€åˆ›å»ºé€‚é…å™¨å®ä¾‹

```typescript
// SDK å†…éƒ¨
class SDK {
  private createAdapter(config: AdapterConfig) {
    const AdapterClass = config.class;
    return new AdapterClass(config.config);
  }

  async init() {
    for (const [name, config] of Object.entries(this.config.adapters)) {
      const adapter = this.createAdapter(config);
      await adapter.init(config.config);
      this.adapters.set(name, adapter);
    }
  }
}
```

### 6. å•ä¾‹æ¨¡å¼ (Singleton Pattern)
**ç›®çš„**: ç¡®ä¿ SDK å®ä¾‹å”¯ä¸€æ€§ï¼ˆå¯é€‰ï¼‰

```typescript
class SDK {
  private static instance?: SDK;

  static getInstance(config?: SDKConfig): SDK {
    if (!SDK.instance && config) {
      SDK.instance = new SDK(config);
    }
    return SDK.instance!;
  }
}
```

### 7. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
**ç›®çš„**: å¯åˆ‡æ¢çš„èƒ½åŠ›å®ç°

```typescript
// ä¸åŒå¹³å°çš„æ¶ˆæ¯å‘é€ç­–ç•¥
interface SendStrategy {
  send(content: SendContent): Promise<SendResult>;
}

class TelegramSendStrategy implements SendStrategy {
  async send(content: SendContent) {
    // Telegram å‘é€é€»è¾‘
  }
}

class DiscordSendStrategy implements SendStrategy {
  async send(content: SendContent) {
    // Discord å‘é€é€»è¾‘
  }
}
```

---

## ä»£ç ç»„ç»‡ç»“æ„

### Monorepo ç»“æ„
```
omnichat/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/                    # æ ¸å¿ƒ SDK
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ core/           # SDK ä¸»ç±»
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sdk.ts      # SDK å®ç°
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ adapter.ts  # é€‚é…å™¨åŸºç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ message.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ capabilities.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cache.ts    # TTL ç¼“å­˜
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ queue.ts    # è¯·æ±‚é˜Ÿåˆ—
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ rate-limit.ts # é€Ÿç‡é™åˆ¶
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ resilient.ts  # ç†”æ–­å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ errors/         # é”™è¯¯å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ index.ts        # å¯¼å‡º
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”‚
â”‚   â”œâ”€â”€ adapters/               # å¹³å°é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ telegram/
â”‚   â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ adapter.ts        # ä¸»é€‚é…å™¨ (1981 è¡Œ)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ client/           # API å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ cached-client.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ integration/          # é›†æˆæµ‹è¯•
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ message-operations.integration.test.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ interactive-features.integration.test.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ chat-management.integration.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ discord/            # Discord é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ slack/              # Slack é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ whatsapp/           # WhatsApp é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ signal/             # Signal é€‚é…å™¨ï¼ˆstubï¼‰
â”‚   â”‚   â””â”€â”€ imessage/           # iMessage é€‚é…å™¨ï¼ˆstubï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ examples/               # ç¤ºä¾‹åº”ç”¨
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ unified-bot.ts           # å¤šå¹³å°ç»Ÿä¸€å…¥å£ (21K è¡Œ)
â”‚       â”‚   â”œâ”€â”€ simple-bot.ts            # ç®€å•ç¤ºä¾‹
â”‚       â”‚   â”œâ”€â”€ telegram-chat-management.ts
â”‚       â”‚   â””â”€â”€ smart-type-inference-example.ts
â”‚       â”œâ”€â”€ .env.example
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ docs/                       # æ–‡æ¡£
â”‚   â”œâ”€â”€ CHANGELOG.md
â”‚   â”œâ”€â”€ BOT_COMMANDS.md
â”‚   â”œâ”€â”€ ADAPTER_STATUS.md
â”‚   â””â”€â”€ SECURITY.md
â”‚
â”œâ”€â”€ README.md                   # ä¸»æ–‡æ¡£
â”œâ”€â”€ DESIGN_ANALYSIS.md         # è®¾è®¡åˆ†æ
â”œâ”€â”€ REFACTORING_COMPLETE.md    # é‡æ„æ€»ç»“
â”œâ”€â”€ BOT_MANAGEMENT.md          # Bot ç®¡ç†
â”œâ”€â”€ QUICK_START.md             # å¿«é€Ÿå¼€å§‹
â”œâ”€â”€ package.json               # æ ¹é…ç½®
â”œâ”€â”€ pnpm-workspace.yaml        # Workspace é…ç½®
â””â”€â”€ tsconfig.base.json         # TS åŸºç¡€é…ç½®
```

### åŒ…ä¾èµ–å…³ç³»
```
examples â†’ telegram, discord, slack, whatsapp
   â†“
telegram â†’ core
discord â†’ core  
slack â†’ core
whatsapp â†’ core
   â†“
core (æ— å¤–éƒ¨ä¾èµ–)
```

---

## æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. æ¶ˆæ¯å‘é€

```typescript
// SDK.send() å®ç°è§£æ
async send(
  platform: string,
  content: SendContent,
  options?: SendOptions
): Promise<SendResult> {
  // 1. è·å–é€‚é…å™¨
  const adapter = this.adapters.get(platform);
  if (!adapter) {
    throw new Error(`Adapter ${platform} not found`);
  }

  // 2. éªŒè¯å¿…éœ€å­—æ®µ
  validateAtLeastOne(content, ['text', 'mediaUrl', 'stickerId']);

  // 3. è§£æç›®æ ‡
  const target = options?.to || '';

  // 4. ä¸­é—´ä»¶é¢„å¤„ç†ï¼ˆå¯é€‰ï¼‰
  await this.runMiddlewares({ platform, content, options });

  // 5. è°ƒç”¨é€‚é…å™¨å‘é€
  const result = await adapter.send(target, content, options);

  // 6. è¿”å›æ ‡å‡†åŒ–ç»“æœ
  return {
    platform,
    messageId: result.messageId,
    chatId: result.chatId,
    timestamp: result.timestamp || Date.now(),
  };
}
```

**æµç¨‹å›¾**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº”ç”¨è°ƒç”¨    â”‚
â”‚ sdk.send()  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‚æ•°éªŒè¯    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è·å–é€‚é…å™¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸­é—´ä»¶å¤„ç†  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€‚é…å™¨å‘é€  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿”å›ç»“æœ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. æ¶ˆæ¯æ¥æ”¶

```typescript
// é€‚é…å™¨æ³¨å†Œå›è°ƒ
adapter.onMessage((rawMessage) => {
  // 1. å¹³å°æ¶ˆæ¯ â†’ æ ‡å‡†åŒ–æ ¼å¼
  const message: Message = {
    platform: 'telegram',
    messageId: rawMessage.message_id.toString(),
    from: {
      id: rawMessage.from.id.toString(),
      username: rawMessage.from.username,
      name: rawMessage.from.first_name,
    },
    chat: {
      id: rawMessage.chat.id.toString(),
      type: rawMessage.chat.type,
      name: rawMessage.chat.title,
    },
    content: {
      text: rawMessage.text,
      // ... å…¶ä»–å†…å®¹
    },
    timestamp: rawMessage.date * 1000,
  };

  // 2. è§¦å‘ SDK äº‹ä»¶
  sdk.emit('message', message);
});

// åº”ç”¨å±‚ç›‘å¬
sdk.on(async (message) => {
  // å¤„ç†æ ‡å‡†åŒ–æ¶ˆæ¯
  if (message.content.text === '/start') {
    await sdk.send(message.platform, {
      text: 'Welcome!'
    }, { to: message.from.id });
  }
});
```

### 3. èƒ½åŠ›æ£€æµ‹

```typescript
// å®ç°æœºåˆ¶
class SDK {
  getCapabilities(platform: string): Capabilities {
    const adapter = this.adapters.get(platform);
    return adapter?.getCapabilities() || defaultCapabilities;
  }

  hasCapability(
    platform: string,
    category: keyof Capabilities,
    feature: string
  ): boolean {
    const caps = this.getCapabilities(platform);
    return caps[category]?.[feature] === true;
  }

  getAdaptersByCapability(
    category: keyof Capabilities,
    feature: string
  ): string[] {
    return Array.from(this.adapters.entries())
      .filter(([_, adapter]) => {
        const caps = adapter.getCapabilities();
        return caps[category]?.[feature] === true;
      })
      .map(([name]) => name);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
if (sdk.hasCapability('telegram', 'interaction', 'buttons')) {
  await sdk.sendButtons('telegram', chatId, 'Choose:', [
    [{ text: 'Option A', data: 'a' }],
    [{ text: 'Option B', data: 'b' }],
  ]);
} else {
  // é™çº§å¤„ç†
  await sdk.send('telegram', { text: 'Options: A or B' });
}
```

---

## å¤šå¹³å°æ”¯æŒç­–ç•¥

### å¹³å°å·®å¼‚å¤„ç†

#### 1. ID æ ¼å¼ç»Ÿä¸€

**é—®é¢˜**: ä¸åŒå¹³å°çš„ ID æ ¼å¼ä¸åŒ
- Telegram: æ•°å­—ï¼ˆç”¨æˆ·æ­£æ•°ï¼Œç¾¤ç»„è´Ÿæ•°ï¼‰
- Discord: å­—ç¬¦ä¸²ï¼ˆé›ªèŠ± IDï¼‰
- Slack: å­—ç¬¦ä¸²ï¼ˆU/C å‰ç¼€ï¼‰

**è§£å†³æ–¹æ¡ˆ**: ç»Ÿä¸€ä¸ºå­—ç¬¦ä¸²ï¼Œå†…éƒ¨è½¬æ¢

```typescript
// Telegram é€‚é…å™¨
function telegramIdToPublicId(telegramId: number): string {
  if (telegramId > 0) {
    // ç”¨æˆ· ID: è®¾ç½®æ ‡å¿—ä½
    return String(SIGN_BIT | (telegramId & ABS_MASK));
  }
  // ç¾¤ç»„ ID: ç»å¯¹å€¼
  return String(Math.abs(telegramId));
}

function publicIdToTelegramId(publicId: string): string {
  const id = parseInt(publicId, 10);
  if ((id & SIGN_BIT) !== 0) {
    return String(id & ABS_MASK);
  }
  return String(id);
}
```

#### 2. æ¶ˆæ¯ç±»å‹æ˜ å°„

**é—®é¢˜**: å„å¹³å°çš„æ¶ˆæ¯ç±»å‹ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**: å®šä¹‰ç»Ÿä¸€çš„æ¶ˆæ¯æ¨¡å‹

```typescript
// ç»Ÿä¸€æ¶ˆæ¯å†…å®¹
interface SendContent {
  text?: string;
  mediaUrl?: string;
  mediaType?: 'image' | 'video' | 'audio' | 'file';
  stickerId?: string;
}

// Telegram é€‚é…å™¨æ˜ å°„
async send(target: string, content: SendContent) {
  if (content.mediaUrl) {
    switch (content.mediaType) {
      case 'image':
        return this.bot.sendPhoto(chatId, content.mediaUrl);
      case 'video':
        return this.bot.sendVideo(chatId, content.mediaUrl);
      // ...
    }
  }
  return this.bot.sendMessage(chatId, content.text);
}

// Discord é€‚é…å™¨æ˜ å°„
async send(target: string, content: SendContent) {
  const channel = await this.client.channels.fetch(target);
  
  if (content.mediaUrl) {
    return channel.send({
      content: content.text,
      files: [content.mediaUrl],
    });
  }
  return channel.send({ content: content.text });
}
```

#### 3. èƒ½åŠ›å£°æ˜

**é—®é¢˜**: å„å¹³å°åŠŸèƒ½æ”¯æŒä¸åŒ

**è§£å†³æ–¹æ¡ˆ**: é€‚é…å™¨æ˜¾å¼å£°æ˜èƒ½åŠ›

```typescript
// Telegram å®Œæ•´èƒ½åŠ›
getCapabilities(): Capabilities {
  return {
    base: { sendText: true, sendMedia: true, receive: true },
    conversation: { reply: true, edit: true, delete: true, threads: false },
    interaction: { buttons: true, polls: true, reactions: true, stickers: true },
    discovery: { history: true, search: false, pins: true, memberInfo: true },
    management: { kick: true, ban: true, timeout: false },
  };
}

// WhatsApp éƒ¨åˆ†èƒ½åŠ›
getCapabilities(): Capabilities {
  return {
    base: { sendText: true, sendMedia: true, receive: true },
    conversation: { reply: false, edit: false, delete: false },
    interaction: { buttons: false, polls: false, reactions: false },
    discovery: { history: false, search: false, pins: false },
    management: { kick: false, ban: false },
  };
}
```

### å¤šå¹³å°ç»Ÿä¸€å…¥å£å®ç°

#### é…ç½®ç»“æ„
```typescript
const CONFIG = {
  platforms: {
    enabled: ['telegram', 'discord', 'slack'],

    telegram: {
      adapter: TelegramAdapter,
      getToken: (config) => config.telegram?.apiToken,
      getConfig: () => ({
        enableCache: true,
        enableQueue: true,
        queueConcurrency: 10,
      }),
    },

    discord: {
      adapter: DiscordAdapter,
      getToken: (config) => config.discord?.botToken,
      getConfig: () => ({
        enableCache: true,
      }),
    },
  },
};
```

#### åŠ¨æ€åˆå§‹åŒ–
```typescript
async function initializeSDK() {
  const adaptersConfig: Record<string, any> = {};

  // éå†å¯ç”¨çš„å¹³å°
  for (const platform of CONFIG.platforms.enabled) {
    const platformConfig = CONFIG.platforms[platform];
    const token = platformConfig.getToken(config);

    if (!token) {
      console.warn(`âš ï¸  è·³è¿‡æœªé…ç½®çš„å¹³å°: ${platform}`);
      continue;
    }

    // åŠ¨æ€æ„å»ºé…ç½®
    adaptersConfig[platform] = {
      class: platformConfig.adapter,
      config: {
        apiToken: token,
        ...platformConfig.getConfig(),
      },
    };
  }

  // åˆå§‹åŒ– SDK
  const sdk = new SDK({ adapters: adaptersConfig });
  await sdk.init();

  return sdk;
}
```

#### å¹³å°æ— å…³çš„æ¶ˆæ¯å¤„ç†
```typescript
sdk.on(async (message) => {
  // âœ… ä½¿ç”¨ message.platformï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç 
  const platform = message.platform;

  // å‘½ä»¤å¤„ç†ï¼ˆå¹³å°æ— å…³ï¼‰
  if (message.content.text === '/start') {
    await sdk.send(platform, {
      text: 'æ¬¢è¿ï¼æ”¯æŒçš„å‘½ä»¤: /help, /info'
    }, { to: message.from.id });
  }

  // åª’ä½“å¤„ç†ï¼ˆå¹³å°æ— å…³ï¼‰
  if (message.content.mediaUrl) {
    console.log(`${platform}: æ”¶åˆ°åª’ä½“ ${message.content.mediaType}`);
  }
});
```

---

## æ€§èƒ½ä¼˜åŒ–æœºåˆ¶

### 1. ç¼“å­˜ç³»ç»Ÿ

#### TTL ç¼“å­˜å®ç°
```typescript
export class SimpleCache<T> {
  private cache = new Map<string, { value: T; expiry: number }>();
  private ttl: number;

  constructor(ttl = 60000) {
    this.ttl = ttl;
  }

  get(key: string): T | undefined {
    const item = this.cache.get(key);
    if (!item) return undefined;

    if (Date.now() > item.expiry) {
      this.cache.delete(key);
      return undefined;
    }

    return item.value;
  }

  set(key: string, value: T): void {
    this.cache.set(key, {
      value,
      expiry: Date.now() + this.ttl,
    });
  }
}
```

#### ä½¿ç”¨åœºæ™¯
```typescript
// Telegram é€‚é…å™¨ä¸­ç¼“å­˜èŠå¤©ä¿¡æ¯
private chatInfoCache = createCache<ChatInfo>(60000); // 60 ç§’

async getChat(chatId: string): Promise<ChatInfo> {
  // å…ˆæŸ¥ç¼“å­˜
  const cached = this.chatInfoCache.get(chatId);
  if (cached) {
    this.logger.debug('Cache hit:', chatId);
    return cached;
  }

  // ç¼“å­˜æœªå‘½ä¸­ï¼Œè°ƒç”¨ API
  const chat = await this.bot.getChat(chatId);
  this.chatInfoCache.set(chatId, chat);
  return chat;
}
```

### 2. è¯·æ±‚é˜Ÿåˆ—

#### é˜Ÿåˆ—å®ç°
```typescript
export class RequestQueue {
  private queue: Array<() => Promise<any>> = [];
  private running = 0;
  private concurrency: number;

  constructor(concurrency = 5) {
    this.concurrency = concurrency;
  }

  async add<T>(fn: () => Promise<T>): Promise<T> {
    return new Promise((resolve, reject) => {
      this.queue.push(async () => {
        try {
          const result = await fn();
          resolve(result);
        } catch (error) {
          reject(error);
        }
      });
      this.process();
    });
  }

  private async process(): Promise<void> {
    while (this.running < this.concurrency && this.queue.length > 0) {
      const fn = this.queue.shift()!;
      this.running++;
      
      fn().finally(() => {
        this.running--;
        this.process();
      });
    }
  }
}
```

#### ä½¿ç”¨åœºæ™¯
```typescript
// Telegram é€‚é…å™¨ä¸­æ§åˆ¶å¹¶å‘
private queue = createQueue(10); // æœ€å¤š 10 ä¸ªå¹¶å‘

async send(target: string, content: SendContent) {
  // æ‰€æœ‰è¯·æ±‚é€šè¿‡é˜Ÿåˆ—
  return this.queue.add(() => 
    this.bot.sendMessage(chatId, content.text)
  );
}
```

**ä¼˜åŠ¿**:
- é˜²æ­¢è¿‡è½½
- æ§åˆ¶å¹¶å‘æ•°
- é¿å…é€Ÿç‡é™åˆ¶

### 3. é€Ÿç‡é™åˆ¶å’Œé‡è¯•

#### æŒ‡æ•°é€€é¿é‡è¯•
```typescript
export async function withRetry<T>(
  fn: () => Promise<T>,
  options: RetryOptions = {}
): Promise<T> {
  const {
    maxRetries = 3,
    initialDelay = 1000,
    maxDelay = 30000,
    backoffMultiplier = 2,
    jitter = true,
  } = options;

  let lastError: Error;

  for (let attempt = 0; attempt <= maxRetries; attempt++) {
    try {
      return await fn();
    } catch (error) {
      lastError = error as Error;

      if (attempt === maxRetries) break;

      // è®¡ç®—å»¶è¿Ÿï¼ˆæŒ‡æ•°é€€é¿ï¼‰
      let delayMs = Math.min(
        initialDelay * Math.pow(backoffMultiplier, attempt),
        maxDelay
      );

      // æ·»åŠ æŠ–åŠ¨ï¼ˆé¿å…æƒŠç¾¤æ•ˆåº”ï¼‰
      if (jitter) {
        delayMs = delayMs * (0.5 + Math.random() * 0.5);
      }

      // æ£€æŸ¥æ˜¯å¦æ˜¯é€Ÿç‡é™åˆ¶é”™è¯¯
      if (isRateLimitError(error)) {
        const retryAfter = extractRetryAfter(error);
        if (retryAfter) {
          delayMs = retryAfter * 1000;
        }
      }

      await delay(delayMs);
    }
  }

  throw lastError!;
}
```

#### ä»¤ç‰Œæ¡¶é™æµ
```typescript
export class TokenBucket {
  private tokens: number;
  private readonly capacity: number;
  private readonly refillRate: number;
  private lastRefill: number;

  constructor(capacity: number, refillRate: number) {
    this.capacity = capacity;
    this.refillRate = refillRate;
    this.tokens = capacity;
    this.lastRefill = Date.now();
  }

  async acquire(tokens = 1): Promise<void> {
    this.refill();

    while (this.tokens < tokens) {
      await delay(100);
      this.refill();
    }

    this.tokens -= tokens;
  }

  private refill(): void {
    const now = Date.now();
    const elapsed = (now - this.lastRefill) / 1000;
    const tokensToAdd = elapsed * this.refillRate;

    this.tokens = Math.min(
      this.capacity,
      this.tokens + tokensToAdd
    );
    this.lastRefill = now;
  }
}
```

### 4. ç†”æ–­å™¨æ¨¡å¼

```typescript
export class CircuitBreaker {
  private state: CircuitBreakerState = CircuitBreakerState.CLOSED;
  private failureCount = 0;
  private lastFailureTime?: number;

  async execute<T>(fn: () => Promise<T>): Promise<T> {
    // æ£€æŸ¥æ˜¯å¦åº”è¯¥å°è¯•
    if (this.state === CircuitBreakerState.OPEN) {
      if (this.shouldAttemptReset()) {
        this.state = CircuitBreakerState.HALF_OPEN;
      } else {
        throw new Error('Circuit breaker is OPEN');
      }
    }

    try {
      const result = await fn();
      this.onSuccess();
      return result;
    } catch (error) {
      this.onFailure();
      throw error;
    }
  }

  private onSuccess(): void {
    this.failureCount = 0;
    this.state = CircuitBreakerState.CLOSED;
  }

  private onFailure(): void {
    this.failureCount++;
    this.lastFailureTime = Date.now();

    if (this.failureCount >= this.options.failureThreshold) {
      this.state = CircuitBreakerState.OPEN;
    }
  }
}
```

**ä¼˜åŠ¿**:
- å¿«é€Ÿå¤±è´¥
- é˜²æ­¢çº§è”æ•…éšœ
- è‡ªåŠ¨æ¢å¤

---

## å¼€å‘å·¥ä½œæµ

### é¡¹ç›®æ„å»º

```bash
# å®‰è£…ä¾èµ–
pnpm install

# æ„å»ºæ‰€æœ‰åŒ…
pnpm build
# å†…éƒ¨æ‰§è¡Œ: pnpm -r --filter './packages/*' run build

# æ„å»ºå•ä¸ªåŒ…
pnpm --filter @omnichat/core build
pnpm --filter @omnichat/telegram build
```

### æµ‹è¯•æµç¨‹

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pnpm test

# è¿è¡Œå•ä¸ªåŒ…æµ‹è¯•
pnpm --filter @omnichat/core test
pnpm --filter @omnichat/telegram test

# ç›‘å¬æ¨¡å¼
pnpm --filter @omnichat/telegram test --watch
```

**æµ‹è¯•è¦†ç›–**:
```
Core: 41 ä¸ªæµ‹è¯•
Telegram: 157 ä¸ªæµ‹è¯•ï¼ˆ100% æ–¹æ³•è¦†ç›–ï¼‰
Discord/Slack/WhatsApp: å¾…å®Œå–„
```

### å¼€å‘ç¤ºä¾‹

```bash
# è¿è¡Œå¼€å‘æœåŠ¡å™¨
cd packages/examples
pnpm dev

# æˆ–ä½¿ç”¨è„šæœ¬
pnpm --filter @omnichat/example dev        # unified-bot
pnpm --filter @omnichat/example dev:simple # simple-bot
pnpm --filter @omnichat/example dev:chat   # chat-management
```

### ç”Ÿäº§éƒ¨ç½²

```bash
# 1. ç¼–è¯‘é¡¹ç›®
pnpm --filter @omnichat/example build

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp packages/examples/.env.example packages/examples/.env
# ç¼–è¾‘ .env æ·»åŠ  tokens

# 3. åå°å¯åŠ¨
cd packages/examples
pnpm start:bg

# 4. ç®¡ç†å‘½ä»¤
pnpm status    # æŸ¥çœ‹çŠ¶æ€
pnpm logs      # æŸ¥çœ‹æ—¥å¿—
pnpm restart   # é‡å¯
pnpm stop      # åœæ­¢
```

---

## é¡¹ç›®ä¼˜åŠ¿ä¸æŒ‘æˆ˜

### âœ… æ ¸å¿ƒä¼˜åŠ¿

#### 1. æ¶æ„ä¼˜åŠ¿
- **ç»Ÿä¸€æ¥å£**: ä¸€å¥— API æ“ä½œå¤šä¸ªå¹³å°
- **æ¨¡å—åŒ–è®¾è®¡**: æ¾è€¦åˆï¼Œæ˜“æ‰©å±•
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript æ”¯æŒ
- **å¯æµ‹è¯•æ€§**: è‰¯å¥½çš„æµ‹è¯•è¦†ç›–ï¼ˆTelegramï¼‰

#### 2. å·¥ç¨‹ä¼˜åŠ¿
- **Monorepo**: ç»Ÿä¸€ç®¡ç†ï¼Œç‰ˆæœ¬ä¸€è‡´
- **é›¶ä¾èµ– Core**: è½»é‡ï¼Œå¯ç§»æ¤
- **ä¼ä¸šçº§ç‰¹æ€§**: ç¼“å­˜ã€é˜Ÿåˆ—ã€é‡è¯•ã€ç†”æ–­
- **å®Œå–„æ–‡æ¡£**: è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—å’Œç¤ºä¾‹

#### 3. å¯æ‰©å±•æ€§
- **æ’ä»¶åŒ–**: æ˜“äºæ·»åŠ æ–°å¹³å°
- **ä¸­é—´ä»¶**: çµæ´»çš„æ¶ˆæ¯å¤„ç†ç®¡é“
- **èƒ½åŠ›æ£€æµ‹**: ä¼˜é›…çš„åŠŸèƒ½é™çº§
- **äº‹ä»¶é©±åŠ¨**: è§£è€¦çš„æ¶ˆæ¯å¤„ç†

#### 4. å¼€å‘ä½“éªŒ
- **å¿«é€Ÿå¼€å§‹**: ç®€å•çš„é…ç½®å’Œåˆå§‹åŒ–
- **ä¸°å¯Œç¤ºä¾‹**: å¤šä¸ªå®ç”¨ç¤ºä¾‹
- **åå°ç®¡ç†**: ä¾¿æ·çš„ bot ç®¡ç†è„šæœ¬
- **å®æ—¶æ—¥å¿—**: å¼ºå¤§çš„æ—¥å¿—æŸ¥çœ‹å·¥å…·

### âš ï¸ ä¸»è¦æŒ‘æˆ˜

#### 1. æ¶æ„å±‚é¢

**é—®é¢˜**: Core SDK èŒè´£æ··ä¹±
```typescript
// SDK ç±»åšäº†å¤ªå¤šäº‹æƒ…
export class SDK {
  private adapters: Map<string, Adapter>;
  private middlewares: Middleware[];
  private messageCallbacks: Set<MessageCallback>;
  private storage?: Storage;
  // ... 600+ è¡Œä»£ç 
}
```

**å½±å“**: éš¾ä»¥æµ‹è¯•ã€éš¾ä»¥æ‰©å±•

**å»ºè®®**: æ‹†åˆ†ä¸ºç‹¬ç«‹æ¨¡å—
- AdapterManager
- MiddlewarePipeline
- EventEmitter
- StorageManager

#### 2. æ¥å£ä¸€è‡´æ€§

**é—®é¢˜**: `FullAdapter` ä½¿ç”¨ `Partial`
```typescript
export type FullAdapter = Adapter &
  Partial<ConversationAdapter> &
  Partial<InteractionAdapter>;
```

**å½±å“**: è¿è¡Œæ—¶å¯èƒ½è°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•

**å»ºè®®**: 
- æ–¹æ¡ˆ 1: è¿è¡Œæ—¶æ£€æŸ¥
- æ–¹æ¡ˆ 2: æä¾›é»˜è®¤å®ç°
- æ–¹æ¡ˆ 3: ä½¿ç”¨èƒ½åŠ›æ£€æŸ¥

#### 3. å¹³å°é€‚é…å™¨å®Œæˆåº¦ä¸ä¸€

| å¹³å° | æµ‹è¯•è¦†ç›– | æ–‡æ¡£ | ç”Ÿäº§å°±ç»ª |
|------|---------|------|----------|
| Telegram | âœ… 100% | âœ… å®Œå–„ | âœ… æ˜¯ |
| Discord | âš ï¸ 0% | âš ï¸ åŸºç¡€ | âš ï¸ éƒ¨åˆ† |
| Slack | âš ï¸ 0% | âš ï¸ åŸºç¡€ | âš ï¸ éƒ¨åˆ† |
| WhatsApp | âŒ 0% | âŒ ç¼ºå¤± | âŒ å¦ |

**å»ºè®®**: ä»¥ Telegram ä¸ºæ ‡å‡†ï¼Œå®Œå–„å…¶ä»–é€‚é…å™¨

#### 4. é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€

**é—®é¢˜**: å®šä¹‰äº†é”™è¯¯ç±»ä½†æœªå¹¿æ³›ä½¿ç”¨
```typescript
// å®šä¹‰äº†
export class APICallError extends SDKError {}

// ä½†å®é™…ä»£ç ä¸­
throw new Error("Failed to send");  // âŒ
```

**å»ºè®®**: å¼ºåˆ¶ä½¿ç”¨æ ‡å‡†é”™è¯¯ç±»

### ğŸ¯ æ”¹è¿›å»ºè®®ä¼˜å…ˆçº§

#### çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰
1. âœ… **é‡æ„ Core SDK**: æ‹†åˆ†èŒè´£
2. âœ… **ç»Ÿä¸€é”™è¯¯å¤„ç†**: ä½¿ç”¨æ ‡å‡†é”™è¯¯ç±»
3. âš ï¸ **å®Œå–„ Discord é€‚é…å™¨**: æ·»åŠ æµ‹è¯•

#### ä¸­æœŸï¼ˆ1-2 æœˆï¼‰
4. âš ï¸ **å®Œå–„ Slack é€‚é…å™¨**: æ·»åŠ æµ‹è¯•
5. âš ï¸ **ä¿®å¤ WhatsApp é€‚é…å™¨**: reply/delete åŠŸèƒ½
6. âš ï¸ **æ·»åŠ é›†æˆæµ‹è¯•**: å¤šå¹³å°åœºæ™¯

#### é•¿æœŸï¼ˆ3-6 æœˆï¼‰
7. âŒ **æ€§èƒ½ä¼˜åŒ–**: ç›‘æ§å’ŒæŒ‡æ ‡
8. âŒ **å®Œå–„æ–‡æ¡£**: API æ–‡æ¡£ç”Ÿæˆ
9. âŒ **CI/CD**: è‡ªåŠ¨åŒ–æµ‹è¯•å’Œå‘å¸ƒ

---

## æ€»ä½“è¯„åˆ†

### æ¶æ„è®¾è®¡: 7/10
- âœ… è®¾è®¡æ¨¡å¼è¿ç”¨å¾—å½“
- âœ… æ¥å£æŠ½è±¡åˆç†
- âŒ SDK èŒè´£ä¸æ¸…
- âŒ æ¥å£ä¸€è‡´æ€§é—®é¢˜

### ä»£ç è´¨é‡: 6/10
- âœ… Telegram é€‚é…å™¨ä¼˜ç§€
- âš ï¸ Discord/Slack è‰¯å¥½
- âŒ WhatsApp è¾ƒå·®
- âŒ æ•´ä½“ä¸ä¸€è‡´

### æµ‹è¯•è¦†ç›–: 3/10
- âœ… Telegram 100%
- âŒ å…¶ä»–é€‚é…å™¨ 0%
- âŒ Core åŒ…ä¸å®Œæ•´

### å·¥ç¨‹åŒ–: 4/10
- âœ… Monorepo ç»“æ„æ¸…æ™°
- âœ… åå°ç®¡ç†å®Œå–„
- âŒ ç¼ºå°‘ CI/CD
- âŒ ç¼ºå°‘ Lint å·¥å…·

### æ–‡æ¡£å®Œå–„åº¦: 8/10
- âœ… README è¯¦ç»†
- âœ… ç¤ºä¾‹ä¸°å¯Œ
- âœ… é‡æ„æ–‡æ¡£å®Œå–„
- âš ï¸ API æ–‡æ¡£å¾…ç”Ÿæˆ

### **æ€»åˆ†: 28/50 (5.6/10)**

---

## æ€»ç»“

Omnichat æ˜¯ä¸€ä¸ª**è®¾è®¡ç†å¿µå…ˆè¿›ã€æ¶æ„åŸºç¡€æ‰å®**çš„å¤šå¹³å°æ¶ˆæ¯ SDK é¡¹ç›®ã€‚

### ğŸŒŸ äº®ç‚¹
1. **ç»Ÿä¸€æ¥å£**: çœŸæ­£å®ç°äº†è·¨å¹³å°æ¶ˆæ¯çš„ç»Ÿä¸€æŠ½è±¡
2. **Telegram é€‚é…å™¨**: ä½œä¸ºå‚è€ƒå®ç°ï¼Œè´¨é‡æé«˜
3. **ä¼ä¸šçº§ç‰¹æ€§**: ç¼“å­˜ã€é˜Ÿåˆ—ã€é‡è¯•ã€ç†”æ–­ç­‰æœºåˆ¶å®Œå–„
4. **å¼€å‘ä½“éªŒ**: ä¸°å¯Œçš„ç¤ºä¾‹å’Œä¾¿æ·çš„ç®¡ç†å·¥å…·
5. **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„è®¾è®¡æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—

### ğŸ¯ æ”¹è¿›æ–¹å‘
1. **å®Œå–„æ¶æ„**: é‡æ„ Core SDKï¼ŒèŒè´£åˆ†ç¦»
2. **ç»Ÿä¸€è´¨é‡**: æå‡å…¶ä»–é€‚é…å™¨åˆ° Telegram æ°´å¹³
3. **åŠ å¼ºæµ‹è¯•**: æ‰©å±•æµ‹è¯•è¦†ç›–åˆ°æ‰€æœ‰åŒ…
4. **å·¥ç¨‹åŒ–**: æ·»åŠ  CI/CDã€Lintã€æ–‡æ¡£ç”Ÿæˆ
5. **æ€§èƒ½ä¼˜åŒ–**: æ·»åŠ ç›‘æ§å’Œæ€§èƒ½æŒ‡æ ‡

### ğŸš€ æœªæ¥å±•æœ›

ä»¥å½“å‰çš„æ¶æ„åŸºç¡€ï¼Œé…åˆæŒç»­çš„æ”¹è¿›ï¼ŒOmnichat æœ‰æ½œåŠ›æˆä¸ºï¼š
- **å¼€æºç¤¾åŒºçš„æ ‡æ†**: å¤šå¹³å°æ¶ˆæ¯ SDK çš„æœ€ä½³å®è·µ
- **ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ**: æ”¯æŒå¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ
- **å¼€å‘è€…é¦–é€‰**: ç®€å•æ˜“ç”¨ï¼ŒåŠŸèƒ½å®Œå–„

---

**æ€»ç»“**: è¿™æ˜¯ä¸€ä¸ª**æœ‰æ½œåŠ›çš„é¡¹ç›®**ï¼Œéœ€è¦æŒç»­æŠ•å…¥æ¥å®ç°å…¶æ„¿æ™¯ã€‚å½“å‰æœ€ç´§è¿«çš„æ˜¯å®Œå–„æ¶æ„å’Œç»Ÿä¸€ä»£ç è´¨é‡ï¼Œç„¶åé€æ­¥æ‰©å±•å¹³å°æ”¯æŒå’Œä¼ä¸šçº§åŠŸèƒ½ã€‚

ğŸ“… æœ€åæ›´æ–°: 2026-02-11
âœï¸ ä½œè€…: GitHub Copilot
